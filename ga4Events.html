<script>
(function () {
  // --- Event stubs with debug logging ---
  function topscrollEvent(slotInfo) {
    console.log('[SN][Topscroll Event]', {
      ad_unit_path: slotInfo.path,
      slot_element_id: slotInfo.elId,
      rendered_size: slotInfo.renderedSize
    });
  }

  function interstitialEvent(slotInfo) {
    console.log('[SN][Interstitial Event]', {
      ad_unit_path: slotInfo.path,
      slot_element_id: slotInfo.elId,
      rendered_size: slotInfo.renderedSize
    });
  }

  function midscrollEvent(slotInfo) {
    console.log('[SN][Midscroll Event]', {
      ad_unit_path: slotInfo.path,
      slot_element_id: slotInfo.elId,
      rendered_size: slotInfo.renderedSize
    });
  }

  // --- CONFIG ---
  const TOPSCROLL_TOKEN = 'div-gpt-ad-topscroll';
  const INTERSTITIAL_TOKEN = 'interstitial';
  const ALLOWED_MIDSCROLL_SIZES = [
    [300, 240],
    [300, 210],
    [970, 570],
    [970, 550],
    [970, 540]
  ];

  // --- Helpers ---
  function slotInfoFromEvent(ev) {
    const slot = ev.slot;
    return {
      path: typeof slot.getAdUnitPath === 'function' ? slot.getAdUnitPath() : '',
      elId: typeof slot.getSlotElementId === 'function' ? slot.getSlotElementId() : '',
      renderedSize: Array.isArray(ev.size) ? ev.size : null,
      isEmpty: !!ev.isEmpty
    };
  }

  function isMidscrollSize(size) {
    if (!Array.isArray(size)) return false;
    return ALLOWED_MIDSCROLL_SIZES.some(
      allowed => allowed[0] === size[0] && allowed[1] === size[1]
    );
  }

  // --- Attach GPT listener ---
  window.googletag = window.googletag || { cmd: [] };
  googletag.cmd.push(function () {
    googletag.pubads().addEventListener('slotRenderEnded', function (ev) {
      const info = slotInfoFromEvent(ev);
      if (info.isEmpty) return;

      // Topscroll condition
      if ((info.path && info.path.includes(TOPSCROLL_TOKEN)) ||
          (info.elId && info.elId.includes(TOPSCROLL_TOKEN))) {
        topscrollEvent(info);
      }

      // Interstitial condition
      if (info.path && info.path.includes(INTERSTITIAL_TOKEN)) {
        interstitialEvent(info);
      }

      // Midscroll condition
      if (isMidscrollSize(info.renderedSize)) {
        midscrollEvent(info);
      }
    });
  });
})();
</script>
